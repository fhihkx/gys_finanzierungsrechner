<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GYS Finanzierungsrechner</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PURE jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- EmailJS Library -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            // HIER DEINEN EMAILJS PUBLIC KEY EINTRAGEN
            emailjs.init("y0ANsvoTYHNRXCf5R");
        })();
    </script>
    
    <!-- Fonts: Helvetica als Standard -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gys: {
                            blue: '#003E7E',      // GYS Primary Blue
                            blueHover: '#002B5E',
                            yellow: '#FFB800',    // GYS Highlight Yellow
                            yellowHover: '#E6A600',
                            dark: '#111827',      // Dark text
                            text: '#1F2937',      // Main text
                            light: '#F3F5F7',     // Background
                            border: '#E5E7EB'
                        }
                    },
                    fontFamily: {
                        sans: ['Helvetica', 'Arial', 'sans-serif'],
                        heading: ['Helvetica', 'Arial', 'sans-serif']
                    },
                    boxShadow: {
                        'card': '0 20px 60px -15px rgba(0, 62, 126, 0.15)',
                        'glow': '0 0 30px rgba(255, 184, 0, 0.4)',
                        'inner-light': 'inset 0 1px 0 rgba(255,255,255,0.1)'
                    },
                    borderRadius: {
                        '3xl': '24px',
                        '4xl': '32px'
                    },
                    transitionProperty: {
                        'height': 'height, max-height'
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Helvetica', Arial, sans-serif; background-color: #F3F5F7; color: #1F2937; overflow-x: hidden; }
        h1, h2, h3, h4, .font-heading { font-family: 'Helvetica', Arial, sans-serif; }

        /* Navigation Style */
        .nav-item {
            font-weight: 700;
            font-size: 14px;
            color: #1F2937;
            letter-spacing: 0.02em; 
            transition: color 0.2s;
        }
        .nav-item:hover { color: #003E7E; }

        /* Tab Buttons */
        .tab-nav {
            background: #fff;
            padding: 9px; 
            border-radius: 14px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.05);
            display: flex;
            width: 100%;
            max-width: 900px; /* Begrenzt die maximale Breite */
            flex-wrap: wrap;
            justify-content: center;
            gap: 7px; 
        }
        .tab-btn {
            padding: 20px 10px; 
            flex: 1; /* Macht alle Knöpfe exakt gleich groß */
            text-align: center;
            border-radius: 8px;
            font-weight: 700;
            font-size: 18px; 
            color: #6B7280;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
        }
        .tab-btn.active {
            background: #003E7E;
            color: #fff;
            box-shadow: 0 4px 15px rgba(0, 62, 126, 0.3);
            transform: scale(1.02);
        }
        .tab-btn:hover:not(.active) {
            color: #003E7E;
            background: #EBF1F8;
        }

        /* Calculator Specifics */
        .calc-input-wrapper {
            background: #F3F5F7;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            padding: 14px 20px;
            min-height: 56px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        .calc-input-wrapper:focus-within {
            border-color: #003E7E;
            background: #fff;
            box-shadow: 0 0 0 4px rgba(0, 62, 126, 0.1);
            transform: translateY(-2px);
        }
        .calc-input {
            width: 100%;
            background: transparent;
            border: none;
            outline: none;
            font-weight: 700;
            color: #111827;
            font-size: 18px;
            padding: 0;
            margin: 0;
            line-height: normal;
        }
        select.calc-input {
            padding-right: 30px;
            text-overflow: ellipsis;
        }
        
        /* HIDE INPUT SPINNERS (Arrows) */
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        input[type=number] {
          -moz-appearance: textfield;
        }

        .calc-label {
            font-size: 12px;
            font-weight: 700;
            color: #6B7280;
            margin-bottom: 8px;
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Form Inputs (Step 2) */
        .form-input {
            width: 100%;
            background-color: #F3F5F7;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            padding: 14px 16px;
            font-weight: 500;
            color: #111827;
            outline: none;
            transition: all 0.2s;
            line-height: normal;
        }
        .form-input:focus {
            border-color: #003E7E;
            background-color: #fff;
        }

        /* Container Height Transition */
        #content-container {
            transition: height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Helper for Step Transitions within Calculator */
        .step-transition {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .hidden-step {
            display: none;
            opacity: 0;
            pointer-events: none;
        }
        .active-step {
            display: flex;
            opacity: 1;
            pointer-events: auto;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .tab-nav { flex-direction: column; width: 100%; }
            .tab-btn { width: 100%; padding: 16px; font-size: 16px; white-space: normal; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- HEADER -->
    <header class="bg-gys-blue sticky top-0 z-50 border-b border-gys-blueHover transition-all duration-300 shadow-md">
        <div class="max-w-[1400px] mx-auto px-6 md:px-8 py-4 flex items-center justify-between">
            <a href="https://www.gys-schweissen.com/" target="_blank" rel="noopener noreferrer" class="flex items-center group shrink-0">
                <img src="gys_logo.png" alt="GYS Logo" class="h-10 md:h-14 lg:h-16 object-contain group-hover:opacity-80 transition-opacity">
            </a>
            <div class="flex items-center gap-6">
                <a href="https://www.gys-schweissen.com/spip.php?page=contact&no=2&lang=de" target="_blank" rel="noopener noreferrer" class="bg-gys-yellow text-gys-dark px-6 py-3 rounded-md text-sm font-bold tracking-wide hover:bg-gys-yellowHover transition-colors shadow-md whitespace-nowrap">
                    Kontakt
                </a>
            </div>
        </div>
    </header>

    <!-- HERO -->
    <section class="pt-16 pb-12 px-6 text-center">
        <h1 class="text-4xl md:text-6xl font-black text-gys-blue mb-6 tracking-tight">
            GYS Finanzierung
        </h1>
        <p class="text-lg text-gray-500 max-w-2xl mx-auto font-medium">
            Investieren Sie in modernste Schweiß- und Batterieladetechnologie. <br class="hidden md:block">
            Sichern Sie Ihre Liquidität durch flexible Laufzeiten.
        </p>
    </section>

    <!-- MAIN APP AREA -->
    <main class="w-full max-w-6xl mx-auto px-4 md:px-6 pb-24 relative z-10">
        
        <!-- Tab Navigation -->
        <div class="flex justify-center mb-12">
            <div class="tab-nav">
                <button onclick="switchTab('calculator')" id="tab-calculator" class="tab-btn active">Rechner</button>
                <button onclick="switchTab('why')" id="tab-why" class="tab-btn">Ihre Vorteile</button>
                <button onclick="switchTab('compare')" id="tab-compare" class="tab-btn">Leasing vs. Mietkauf</button>
            </div>
        </div>

        <!-- CONTENT CONTAINER (Dynamic Height) -->
        <div id="content-container" class="relative w-full overflow-visible">
            
            <!-- VIEW 1: CALCULATOR -->
            <div id="view-calculator" class="view-content absolute inset-x-0 top-0 w-full opacity-100 transition-all duration-500 z-10">
                <div class="bg-white rounded-xl shadow-card overflow-hidden border border-gray-100 lg:h-auto relative">
                    
                    <!-- STEP 1: CALCULATION -->
                    <div id="calc-step-1" class="flex flex-col lg:flex-row h-full active-step w-full transition-opacity duration-300">
                        <div class="w-full lg:w-7/12 p-8 md:p-10 lg:p-12 flex flex-col justify-start">
                            <div class="flex items-center justify-between mb-8 lg:mb-10 h-10">
                                <h2 class="text-3xl md:text-4xl font-black text-gys-dark font-heading tracking-tight m-0">Finanzierungsrechner</h2>
                            </div>

                            <div class="space-y-8 lg:space-y-10 w-full">
                                <div>
                                    <label class="calc-label">Anschaffungspreis (Netto)</label>
                                    <div class="calc-input-wrapper">
                                        <span class="text-gray-400 font-bold mr-4 text-xl">€</span>
                                        <input type="text" id="price" class="calc-input" placeholder="0,00" inputmode="decimal" oninput="formatPriceInput(this)">
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                    <div>
                                        <label class="calc-label">Laufzeit</label>
                                        <div class="calc-input-wrapper relative">
                                            <select id="duration" class="calc-input appearance-none cursor-pointer bg-transparent w-full pr-8" onchange="updateResidualOptions()">
                                                <option value="" disabled selected>Bitte wählen</option>
                                                <option value="36">36 Monate</option>
                                                <option value="48">48 Monate</option>
                                                <option value="54">54 Monate</option>
                                                <option value="60">60 Monate</option>
                                            </select>
                                            <div class="absolute right-5 text-gys-blue pointer-events-none">
                                                <i class="fa-solid fa-chevron-down text-sm"></i>
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="calc-label">Restwert</label>
                                        <div class="calc-input-wrapper relative">
                                            <select id="residual" class="calc-input appearance-none cursor-pointer bg-transparent w-full pr-8">
                                                <option value="" disabled selected>Bitte wählen</option>
                                                <option value="5">5 %</option>
                                                <option value="10">10 %</option>
                                                <option value="15">15 %</option>
                                            </select>
                                            <div class="absolute right-5 text-gys-blue pointer-events-none">
                                                <i class="fa-solid fa-chevron-down text-sm"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="pt-2">
                                    <button onclick="calculate()" class="w-full py-4 bg-gys-blue text-white font-bold rounded-lg text-sm hover:bg-gys-blueHover transition-all shadow-xl hover:-translate-y-1 flex justify-center items-center gap-3 group tracking-wider">
                                        Rate berechnen 
                                        <i class="fa-solid fa-calculator group-hover:rotate-12 transition-transform"></i>
                                    </button>
                                </div>

                                <div id="error-msg" class="hidden p-4 rounded-lg bg-red-50 border border-red-100 flex items-start md:items-center gap-4 text-red-600 text-sm font-medium animate-pulse">
                                    <i class="fa-solid fa-circle-exclamation text-xl mt-0.5 md:mt-0"></i>
                                    <span id="error-text">Diese Kombination ist aktuell nicht verfügbar.</span>
                                </div>
                            </div>
                        </div>

                        <!-- RIGHT: Result Step 1 -->
                        <div class="w-full lg:w-5/12 bg-gys-blue p-8 md:p-10 lg:p-12 text-white flex flex-col justify-start relative overflow-hidden">
                            <!-- Abstract Background Shapes matching GYS CI -->
                            <div class="absolute top-0 right-0 w-96 h-96 bg-gys-yellow opacity-10 rounded-full blur-[80px] transform translate-x-1/2 -translate-y-1/2"></div>
                            <div class="absolute bottom-0 left-0 w-64 h-64 bg-white opacity-5 rounded-full blur-[60px]"></div>
                            
                            <div class="relative z-10 flex flex-col h-full">
                                <!-- Heading Line -->
                                <div class="flex items-center mb-8 lg:mb-10 h-10">
                                    <div class="inline-block px-4 py-1.5 rounded-md border border-gys-yellow/40 bg-gys-yellow/10 text-[10px] font-bold tracking-widest text-gys-yellow m-0">
                                        Unverbindliches Angebot
                                    </div>
                                </div>

                                <div class="space-y-8 lg:space-y-10 w-full flex-grow flex flex-col">
                                    <!-- Monthly Rate Line -->
                                    <div>
                                        <div class="font-heading text-[12px] font-bold tracking-[0.05em] uppercase text-white/70 mb-2">Monatliche Rate</div>
                                        <div class="h-14 flex items-center">
                                            <div class="text-5xl md:text-6xl font-black tracking-tighter break-words text-white leading-none" id="result-display">0,00 €</div>
                                        </div>
                                    </div>
                                    
                                    <!-- Disclaimer Line -->
                                    <div class="grid grid-cols-1 gap-6">
                                        <div>
                                            <div class="font-heading text-[12px] font-bold tracking-[0.05em] uppercase text-transparent mb-2 select-none hidden sm:block">Hinweis</div>
                                            <div class="sm:h-14 flex items-start pt-2">
                                                <div class="text-[11px] text-white/40 leading-relaxed font-medium">
                                                    *Alle Preise zzgl. gesetzlicher MwSt. vorbehaltlich positiver Bonitätsprüfung durch unsere Finanzierungspartner.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-auto self-end pt-8">
                                    <button onclick="goToStep(2)" id="btn-next" class="w-14 h-14 bg-gys-yellow text-gys-dark rounded-full flex items-center justify-center text-xl hover:bg-white transition-all shadow-lg hover:shadow-glow hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:hover:bg-gys-yellow" disabled>
                                        <i class="fa-solid fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- STEP 2: CONTACT FORM -->
                    <div id="calc-step-2" class="hidden-step flex-col lg:flex-row h-full w-full transition-opacity duration-300">
                        <div class="w-full lg:w-7/12 p-8 md:p-10 lg:p-12 flex flex-col justify-start">
                            <div class="flex items-center mb-6 lg:mb-8 h-10">
                                <h2 class="text-3xl font-black text-gys-dark font-heading m-0 tracking-tight">Kontaktdaten</h2>
                            </div>
                            <p class="text-gray-500 mb-8 text-sm font-medium">Bitte geben Sie Ihre Daten ein, um das unverbindliche Angebot als PDF zu erhalten.</p>

                            <form class="space-y-4 w-full" id="contact-form" onsubmit="event.preventDefault(); downloadOfferPDF();">
                                
                                <!-- NEU: Artikel-Block mit Trennlinie (border-b) und extra Platz (pb-8 mb-4) -->
                                <div class="space-y-4 border-b border-gray-200 pb-8 mb-4">
                                    <div>
                                        <label class="calc-label">Artikelnummer</label>
                                        <input type="text" id="form-artikelnummer" class="form-input" required>
                                    </div>
                                    <div>
                                        <label class="calc-label">Artikelbezeichnung</label>
                                        <input type="text" id="form-artikelbezeichnung" class="form-input" required>
                                    </div>
                                </div>

                                <div>
                                    <label class="calc-label">Finanzierungsart</label>
                                    <div class="relative">
                                        <select id="form-finanzierungsart" class="form-input appearance-none cursor-pointer pr-8" required>
                                            <option value="" disabled selected>Wählen</option>
                                            <option value="Leasing">Leasing</option>
                                            <option value="Mietkauf">Mietkauf</option>
                                        </select>
                                        <div class="absolute right-4 top-1/2 -translate-y-1/2 text-gys-blue pointer-events-none">
                                            <i class="fa-solid fa-chevron-down text-sm"></i>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label class="calc-label">Anrede</label>
                                    <div class="relative">
                                        <select id="form-anrede" class="form-input appearance-none cursor-pointer pr-8" required>
                                            <option value="" disabled selected>Wählen</option>
                                            <option value="Frau">Frau</option>
                                            <option value="Herr">Herr</option>
                                        </select>
                                        <div class="absolute right-4 top-1/2 -translate-y-1/2 text-gys-blue pointer-events-none">
                                            <i class="fa-solid fa-chevron-down text-sm"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label class="calc-label">Vorname</label>
                                        <input type="text" id="form-vorname" class="form-input" required>
                                    </div>
                                    <div>
                                        <label class="calc-label">Nachname</label>
                                        <input type="text" id="form-nachname" class="form-input" required>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label class="calc-label">Telefonnummer</label>
                                        <input type="tel" id="form-telefon" class="form-input" required>
                                    </div>
                                    <div>
                                        <label class="calc-label">E-Mail</label>
                                        <input type="email" id="form-email" class="form-input" required>
                                    </div>
                                </div>

                                <div>
                                    <label class="calc-label">Firmenname</label>
                                    <input type="text" id="form-firma" class="form-input" required>
                                </div>

                                <div>
                                    <label class="calc-label">Adresse & Hausnummer</label>
                                    <input type="text" id="form-strasse" class="form-input" required>
                                </div>

                                <div class="grid grid-cols-3 gap-4">
                                    <div class="col-span-1">
                                        <label class="calc-label">Postleitzahl</label>
                                        <input type="text" id="form-plz" class="form-input" required>
                                    </div>
                                    <div class="col-span-2">
                                        <label class="calc-label">Ort</label>
                                        <input type="text" id="form-ort" class="form-input" required>
                                    </div>
                                </div>

                                <div class="pt-4">
                                    <button type="submit" id="submit-btn" class="w-full bg-gys-yellow text-gys-dark font-bold py-5 rounded-lg text-sm hover:bg-[#E6A600] transition-all shadow-xl hover:shadow-glow hover:-translate-y-1 flex justify-center items-center gap-3 tracking-wider">
                                        <span>Angebot herunterladen</span>
                                        <i class="fa-solid fa-download"></i>
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- RIGHT: Summary Step 2 -->
                        <div class="w-full lg:w-5/12 bg-gys-blue p-8 md:p-10 lg:p-12 text-white flex flex-col justify-start relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-96 h-96 bg-gys-yellow opacity-10 rounded-full blur-[80px] transform translate-x-1/2 -translate-y-1/2"></div>
                            <div class="absolute bottom-0 left-0 w-64 h-64 bg-white opacity-5 rounded-full blur-[60px]"></div>
                            
                            <div class="relative z-10 flex flex-col h-full">
                                <div class="flex items-center mb-6 lg:mb-8 h-10">
                                    <h3 class="font-heading font-black tracking-wide text-2xl m-0">Ihre Finanzierung</h3>
                                </div>
                                
                                <div class="space-y-4 text-sm flex-grow">
                                    <div class="flex justify-between border-b border-white/10 pb-3">
                                        <span class="text-white/70">Anschaffungspreis</span>
                                        <span class="font-bold" id="summary-price">0,00 €</span>
                                    </div>
                                    <div class="flex justify-between border-b border-white/10 pb-3">
                                        <span class="text-white/70">Laufzeit</span>
                                        <span class="font-bold"><span id="summary-duration">0</span> Monate</span>
                                    </div>
                                    <div class="flex justify-between border-b border-white/10 pb-3">
                                        <span class="text-white/70">Anzahlung</span>
                                        <span class="font-bold">0,00 €</span>
                                    </div>
                                    <div class="flex justify-between border-b border-white/10 pb-3">
                                        <span class="text-white/70">Restwert</span>
                                        <span class="font-bold" id="summary-residual-euro">0,00 €</span>
                                    </div>
                                    <div class="flex justify-between border-b border-white/10 pb-3">
                                        <span class="text-white/70">Leasingfaktor</span>
                                        <span class="font-bold" id="summary-leasing-factor">0,00 %</span>
                                    </div>
                                </div>

                                <div class="mt-12">
                                    <div class="text-gys-yellow font-heading text-xs mb-1 font-bold tracking-widest">Monatliche Rate</div>
                                    <div class="text-5xl font-black tracking-tighter" id="summary-rate">0,00 €</div>
                                </div>

                                <div class="mt-10">
                                    <button onclick="goToStep(1)" class="text-white/60 hover:text-white text-sm font-bold flex items-center gap-2 transition-colors tracking-wider">
                                        <i class="fa-solid fa-arrow-left"></i> Zurück
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- VIEW 2: BENEFITS -->
            <!-- Neu: style="display: none;" hinzugefügt, um Geister-Scrolling auf Startseite zu verhindern -->
            <div id="view-why" class="view-content absolute inset-x-0 top-0 w-full opacity-0 pointer-events-none transition-all duration-300" style="display: none;">
                <div class="bg-white rounded-xl shadow-card p-8 md:p-16 lg:p-24 border border-gray-100 flex flex-col justify-center">
                    <div class="text-center mb-16">
                        <h2 class="text-3xl md:text-4xl font-black text-gys-blue mb-4 font-heading">Warum Finanzierung?</h2>
                        <p class="text-gray-500 text-xl font-medium">Intelligentes Wachstum für Ihre Werkstatt & Produktion.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="p-8 md:p-10 rounded-xl bg-gray-50 border border-transparent hover:border-gys-yellow hover:bg-white hover:shadow-xl transition-all duration-300 group">
                            <div class="w-20 h-20 bg-white rounded-lg flex items-center justify-center text-gys-blue text-3xl shadow-sm mb-8 group-hover:bg-gys-yellow group-hover:text-gys-dark transition-colors">
                                <i class="fa-solid fa-wallet"></i>
                            </div>
                            <h3 class="font-black text-3xl mb-4 text-gys-dark">Liquidität</h3>
                            <p class="text-lg text-gray-600 leading-relaxed font-medium">Keine hohe Einmalinvestition. Sie behalten Ihr Kapital für das operative Geschäft.</p>
                        </div>
                        <div class="p-8 md:p-10 rounded-xl bg-gray-50 border border-transparent hover:border-gys-yellow hover:bg-white hover:shadow-xl transition-all duration-300 group">
                            <div class="w-20 h-20 bg-white rounded-lg flex items-center justify-center text-gys-blue text-3xl shadow-sm mb-8 group-hover:bg-gys-yellow group-hover:text-gys-dark transition-colors">
                                <i class="fa-solid fa-chart-line"></i>
                            </div>
                            <h3 class="font-black text-3xl mb-4 text-gys-dark">Planbarkeit</h3>
                            <p class="text-lg text-gray-600 leading-relaxed font-medium">Konstante, feste Raten über die gesamte Laufzeit erleichtern Ihre Budgetplanung.</p>
                        </div>
                        <div class="p-8 md:p-10 rounded-xl bg-gray-50 border border-transparent hover:border-gys-yellow hover:bg-white hover:shadow-xl transition-all duration-300 group">
                            <div class="w-20 h-20 bg-white rounded-lg flex items-center justify-center text-gys-blue text-3xl shadow-sm mb-8 group-hover:bg-gys-yellow group-hover:text-gys-dark transition-colors">
                                <i class="fa-solid fa-bolt"></i>
                            </div>
                            <h3 class="font-black text-3xl mb-4 text-gys-dark">Technologie</h3>
                            <p class="text-lg text-gray-600 leading-relaxed font-medium">Nutzen Sie immer die modernsten GYS Schweiß- und Ladesysteme in Ihrem Betrieb.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 3: LEASING VS MIETKAUF VERGLEICH -->
            <!-- Neu: style="display: none;" hinzugefügt -->
            <div id="view-compare" class="view-content absolute inset-x-0 top-0 w-full opacity-0 pointer-events-none transition-all duration-300" style="display: none;">
                <div class="bg-white rounded-xl shadow-card p-8 md:p-16 lg:p-24 border border-gray-100 flex flex-col justify-center">
                    <div class="text-center mb-16">
                        <h2 class="text-3xl md:text-4xl font-black text-gys-blue mb-4 font-heading">Die richtige Finanzierung finden</h2>
                        <p class="text-gray-500 text-xl font-medium">Leasing oder Mietkauf? Vergleichen Sie die Vorteile beider Modelle.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Leasing Card -->
                        <div class="p-8 md:p-10 rounded-xl bg-gray-50 border border-transparent hover:border-gys-blue hover:bg-white hover:shadow-xl transition-all duration-300 group flex flex-col h-full">
                            <div class="w-16 h-16 bg-white rounded-lg flex items-center justify-center text-gys-blue text-2xl shadow-sm mb-6 group-hover:bg-gys-blue group-hover:text-white transition-colors">
                                <i class="fa-solid fa-file-contract"></i>
                            </div>
                            <h3 class="font-black text-3xl mb-4 text-gys-dark">Leasing</h3>
                            <p class="text-gray-600 font-medium mb-8 text-lg">Sie zahlen nur für die Nutzung der GYS Ausrüstung, ähnlich wie bei einer Miete. Ideal, um technisch immer auf dem neuesten Stand zu bleiben.</p>
                            
                            <div class="mt-auto">
                                <ul class="space-y-5 text-base text-gray-700">
                                    <li class="flex items-start gap-3">
                                        <i class="fa-solid fa-check text-gys-yellow mt-1 text-lg"></i> 
                                        <span><strong>Bilanzneutral:</strong> Investition taucht nicht in der Bilanz auf und schont die Eigenkapitalquote.</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <i class="fa-solid fa-check text-gys-yellow mt-1 text-lg"></i> 
                                        <span><strong>Steuervorteil:</strong> Die Leasingraten sind in der Regel als Betriebsausgaben voll steuerlich absetzbar.</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <i class="fa-solid fa-check text-gys-yellow mt-1 text-lg"></i> 
                                        <span><strong>Automatischer Erwerb:</strong> Am Ende der Laufzeit erwerben Sie das Gerät automatisch und es geht in Ihren Besitz über.</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Mietkauf Card -->
                        <div class="p-8 md:p-10 rounded-xl bg-gray-50 border border-transparent hover:border-gys-blue hover:bg-white hover:shadow-xl transition-all duration-300 group flex flex-col h-full">
                            <div class="w-16 h-16 bg-white rounded-lg flex items-center justify-center text-gys-blue text-2xl shadow-sm mb-6 group-hover:bg-gys-blue group-hover:text-white transition-colors">
                                <i class="fa-solid fa-handshake"></i>
                            </div>
                            <h3 class="font-black text-3xl mb-4 text-gys-dark">Mietkauf</h3>
                            <p class="text-gray-600 font-medium mb-8 text-lg">Der klassische Weg zum Eigentum. Nach Zahlung der vereinbarten Raten geht die Ausrüstung am Ende automatisch in Ihren Besitz über.</p>
                            
                            <div class="mt-auto">
                                <ul class="space-y-5 text-base text-gray-700">
                                    <li class="flex items-start gap-3">
                                        <i class="fa-solid fa-check text-gys-yellow mt-1 text-lg"></i> 
                                        <span><strong>Automatisches Eigentum:</strong> Mit Zahlung der letzten Rate gehört die Ausrüstung zu 100 % Ihnen.</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <i class="fa-solid fa-check text-gys-yellow mt-1 text-lg"></i> 
                                        <span><strong>Bilanzierung:</strong> Die Maschine wird direkt in Ihrem eigenen Anlagevermögen aktiviert.</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <i class="fa-solid fa-check text-gys-yellow mt-1 text-lg"></i> 
                                        <span><strong>Abschreibung:</strong> Sie profitieren selbst von den steuerlichen Abschreibungsmöglichkeiten (AfA).</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Z-Index auf 30 erhöht und Links mit rel="noopener noreferrer" für Sicherheit ausgestattet -->
    <footer class="bg-white border-t border-gray-200 py-12 mt-auto relative z-30">
        <div class="max-w-[1400px] mx-auto px-8 flex flex-col md:flex-row justify-between items-center gap-6">
            <a href="https://www.gys-schweissen.com/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 group">
                <img src="gys_logo.png" alt="GYS Logo" class="h-10 md:h-12 object-contain group-hover:opacity-80 transition-opacity">
            </a>
            <div class="flex flex-wrap items-center gap-4 md:gap-8 text-sm font-bold text-gys-dark tracking-wide justify-center md:justify-end relative z-40">
                <a href="https://www.gys-schweissen.com/spip.php?page=verbindung&id_article=157&lang=de" target="_blank" rel="noopener noreferrer" class="hover:text-gys-blue transition-colors">Historie</a>
                <a href="https://www.gys-schweissen.com/spip.php?page=impressum&id_article=380&lang=de" target="_blank" rel="noopener noreferrer" class="hover:text-gys-blue transition-colors">Impressum</a>
                <a href="https://www.gys-schweissen.com/spip.php?page=rgpd&lang=de&keep=de" target="_blank" rel="noopener noreferrer" class="hover:text-gys-blue transition-colors">Datenschutzerklärung</a>
            </div>
        </div>
    </footer>

    <!-- LOGIC -->
    <script>
        const factors = {
            "15": { "36": 2.93, "48": 2.27, "54": null, "60": null },
            "10": { "36": 3.06, "48": 2.36, "54": 2.13, "60": null },
            "5":  { "36": null, "48": 2.45, "54": 2.21, "60": 2.02 }
        };

        // --- ROBUSTE HÖHENBERECHNUNG (RESIZEOBSERVER) ---
        let resizeObserver;
        function setupResizeObserver() {
            const container = document.getElementById('content-container');
            resizeObserver = new ResizeObserver(entries => {
                for (let entry of entries) {
                    if (entry.target.style.display !== 'none' && entry.target.style.opacity !== '0') {
                        container.style.height = entry.target.scrollHeight + 'px';
                    }
                }
            });
            
            document.querySelectorAll('.view-content').forEach(view => {
                resizeObserver.observe(view);
            });
        }

        window.addEventListener('load', () => {
            switchTab('calculator');
            setupResizeObserver();
        });

        window.addEventListener('resize', () => {
            const activeBtn = document.querySelector('.tab-btn.active');
            if(activeBtn) {
                const id = activeBtn.id.replace('tab-', '');
                adjustContainerHeight(id);
            }
        });

        function adjustContainerHeight(tabId) {
            const container = document.getElementById('content-container');
            const activeView = document.getElementById('view-' + tabId);
            if(activeView) {
                requestAnimationFrame(() => {
                    container.style.height = activeView.scrollHeight + 'px';
                });
            }
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.id === 'tab-' + tabId) btn.classList.add('active');
            });

            document.querySelectorAll('.view-content').forEach(view => {
                if (view.id !== 'view-' + tabId) {
                    view.style.opacity = '0';
                    view.style.pointerEvents = 'none';
                    view.style.zIndex = '0';
                    
                    // NEU: Nach der Ausblend-Animation (300ms) komplett aus dem DOM nehmen
                    // Das verhindert den unsichtbaren Überlapp und behebt die Footer-Links
                    setTimeout(() => {
                        if (view.style.opacity === '0') {
                            view.style.display = 'none';
                        }
                    }, 300);
                }
            });

            const activeView = document.getElementById('view-' + tabId);
            if(activeView) {
                // NEU: Erst Block setzen, dann kurz darauf sanft einblenden
                activeView.style.display = 'block';
                
                setTimeout(() => {
                    activeView.style.opacity = '1';
                    activeView.style.pointerEvents = 'auto';
                    activeView.style.zIndex = '10';
                }, 20);
                
                setTimeout(() => adjustContainerHeight(tabId), 40);
            }
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(value);
        }

        function formatPriceInput(input) {
            let val = input.value.replace(/\./g, '');
            val = val.replace(/[^\d,]/g, '');
            let parts = val.split(',');
            if (parts.length > 2) {
                parts = [parts[0], parts.slice(1).join('')];
            }
            let integerPart = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            if (parts.length > 1) {
                input.value = integerPart + ',' + parts[1].substring(0, 2); 
            } else {
                input.value = integerPart;
            }
        }

        function updateResidualOptions() {
            const duration = document.getElementById('duration').value;
            const residualSelect = document.getElementById('residual');
            const options = residualSelect.options;

            for (let i = 0; i < options.length; i++) {
                const val = options[i].value;
                
                // Standardmäßig erstmal alles einblenden
                options[i].hidden = false;
                options[i].disabled = false;
                options[i].style.display = '';
                
                // Logik zum Ausblenden bestimmter Kombinationen
                if (duration === "60" && (val === "10" || val === "15")) {
                    options[i].hidden = true;
                    options[i].disabled = true;
                    options[i].style.display = 'none'; 
                } else if (duration === "36" && val === "5") {
                    options[i].hidden = true;
                    options[i].disabled = true;
                    options[i].style.display = 'none'; 
                } else if (duration === "54" && val === "15") {
                    // NEU: 15% bei 54 Monaten ausblenden
                    options[i].hidden = true;
                    options[i].disabled = true;
                    options[i].style.display = 'none'; 
                }
            }

            // Automatischer Fallback, falls die aktuelle Auswahl ungültig wird
            if (duration === "60" && (residualSelect.value === "10" || residualSelect.value === "15")) {
                residualSelect.value = "5";
            } else if (duration === "36" && residualSelect.value === "5") {
                residualSelect.value = "10";
            } else if (duration === "54" && residualSelect.value === "15") {
                // Fallback auf 10%, wenn 54 Monate gewählt und 15% aktiv war
                residualSelect.value = "10";
            }
        }

        function calculate() {
            const priceInput = document.getElementById('price').value;
            const duration = document.getElementById('duration').value;
            const residual = document.getElementById('residual').value;
            
            const resultDisplay = document.getElementById('result-display');
            const errorMsg = document.getElementById('error-msg');
            const errorText = document.getElementById('error-text');
            const nextBtn = document.getElementById('btn-next');

            const price = parseFloat(priceInput.replace(/\./g, '').replace(',', '.'));

            if (!duration || !residual) return;

            const factor = factors?.[residual]?.[duration] ?? null;

            if (factor === null) {
                resultDisplay.innerText = "—";
                errorText.innerText = `Diese Kombination (${duration} Monate / ${residual}%) ist aktuell nicht verfügbar.`;
                errorMsg.classList.remove('hidden');
                nextBtn.disabled = true;
                adjustContainerHeight('calculator'); // Container Höhe anpassen
            } else {
                errorMsg.classList.add('hidden');
                adjustContainerHeight('calculator'); // Container Höhe anpassen
                
                if (price && price > 0) {
                    const rate = price * (factor / 100);
                    resultDisplay.innerText = formatCurrency(rate);
                    nextBtn.disabled = false;
                } else {
                    resultDisplay.innerText = "0,00 €";
                    nextBtn.disabled = true;
                }
            }
        }

        function goToStep(step) {
            const step1 = document.getElementById('calc-step-1');
            const step2 = document.getElementById('calc-step-2');

            if (step === 2) {
                const priceStr = document.getElementById('price').value || "0";
                const durationVal = document.getElementById('duration').value;
                const residualVal = document.getElementById('residual').value;
                const rateVal = document.getElementById('result-display').innerText;

                const price = parseFloat(priceStr.replace(/\./g, '').replace(',', '.')) || 0;
                const residualEuro = price * (parseFloat(residualVal) / 100);
                const factor = factors[residualVal]?.[durationVal];
                
                const formatFactor = (f) => f ? f.toString().replace('.', ',') + ' %' : '- %';
                const formattedPrice = new Intl.NumberFormat('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(price);

                document.getElementById('summary-price').innerText = formattedPrice + ' €';
                document.getElementById('summary-duration').innerText = durationVal;
                document.getElementById('summary-residual-euro').innerText = formatCurrency(residualEuro);
                document.getElementById('summary-leasing-factor').innerText = formatFactor(factor);
                document.getElementById('summary-rate').innerText = rateVal;

                step1.classList.remove('active-step', 'flex');
                step1.classList.add('hidden-step');
                
                step2.classList.remove('hidden-step');
                step2.classList.add('active-step', 'flex');
                
                // Höhe anpassen und für Mobile-Nutzer nach oben scrollen
                setTimeout(() => adjustContainerHeight('calculator'), 50);
                setTimeout(() => adjustContainerHeight('calculator'), 300);
                window.scrollTo({ top: document.getElementById('content-container').offsetTop - 100, behavior: 'smooth' });
                
            } else {
                step2.classList.remove('active-step', 'flex');
                step2.classList.add('hidden-step');

                step1.classList.remove('hidden-step');
                step1.classList.add('active-step', 'flex');
                
                // Höhe anpassen und scrollen
                setTimeout(() => adjustContainerHeight('calculator'), 50);
                setTimeout(() => adjustContainerHeight('calculator'), 300);
                window.scrollTo({ top: document.getElementById('content-container').offsetTop - 100, behavior: 'smooth' });
            }
        }

        function getBase64Logo() {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        resolve({ data: canvas.toDataURL('image/png'), w: img.width, h: img.height });
                    } catch (e) {
                        fallbackFetchLoader(resolve);
                    }
                };
                img.onerror = () => {
                    fallbackFetchLoader(resolve);
                };
                img.src = 'gys_logo.png?' + new Date().getTime();
            });
        }

        function fallbackFetchLoader(resolve) {
            fetch('gys_logo.png')
                .then(r => r.blob())
                .then(blob => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        const img = new Image();
                        img.onload = () => resolve({ data: reader.result, w: img.width, h: img.height });
                        img.src = reader.result;
                    };
                    reader.readAsDataURL(blob);
                })
                .catch(() => resolve(null));
        }

        // --- PURE jsPDF GENERATOR & EMAILJS INTEGRATION FÜR GYS ---
        async function downloadOfferPDF() {
            const btn = document.getElementById('submit-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span>Angebot wird erstellt...</span> <i class="fa-solid fa-spinner fa-spin"></i>';
            btn.disabled = true;

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ orientation: "portrait", unit: "mm", format: "a4" });

                const art = document.getElementById('form-finanzierungsart').value;
                const anrede = document.getElementById('form-anrede').value;
                const vorname = document.getElementById('form-vorname').value;
                const nachname = document.getElementById('form-nachname').value;
                const telefon = document.getElementById('form-telefon').value;
                const email = document.getElementById('form-email').value;
                const artikelnummer = document.getElementById('form-artikelnummer').value;
                const artikelbezeichnung = document.getElementById('form-artikelbezeichnung').value;
                const firma = document.getElementById('form-firma').value;
                const strasse = document.getElementById('form-strasse').value;
                const plz = document.getElementById('form-plz').value;
                const ort = document.getElementById('form-ort').value;

                let salutation = anrede === "Frau" ? `Sehr geehrte Frau ${nachname},` :
                                 anrede === "Herr" ? `Sehr geehrter Herr ${nachname},` :
                                 `Guten Tag ${vorname} ${nachname},`;

                const date = new Date();
                const datum = ('0' + date.getDate()).slice(-2) + '.' + ('0' + (date.getMonth() + 1)).slice(-2) + '.' + date.getFullYear();

                const preisVal = document.getElementById('summary-price').textContent.replace('€', '').trim();
                const laufzeitVal = document.getElementById('summary-duration').textContent.replace('Monate', '').trim();
                const restwertEuroVal = document.getElementById('summary-residual-euro').textContent.replace('€', '').trim();
                let leasingfaktorVal = document.getElementById('summary-leasing-factor').textContent.trim();
                const rateVal = document.getElementById('summary-rate').textContent.replace('€', '').trim();

                const logo = await getBase64Logo();
                if (logo && logo.data) {
                    const maxW = 50; const maxH = 15;
                    let imgW = maxW;
                    let imgH = (logo.h * maxW) / logo.w;
                    if (imgH > maxH) {
                        imgH = maxH;
                        imgW = (logo.w * maxH) / logo.h;
                    }
                    doc.addImage(logo.data, 'PNG', 190 - imgW, 20, imgW, imgH); 
                } else {
                    doc.setFontSize(16); doc.setFont("helvetica", "bold");
                    doc.setTextColor(0, 62, 126); // GYS Blue Text Fallback
                    doc.text("GYS", 190, 25, { align: "right" });
                    doc.setTextColor(0, 0, 0); 
                }

                doc.setFontSize(10);
                doc.setFont("helvetica", "normal");
                // Adressblock oben links um Telefon und E-Mail erweitert
                doc.text([
                    firma, 
                    `${anrede} ${vorname} ${nachname}`, 
                    strasse, 
                    `${plz} ${ort}`,
                    `Tel.: ${telefon}`,
                    `E-Mail: ${email}`
                ], 20, 45);

                doc.text(`Aachen, ${datum}`, 190, 60, { align: "right" });

                doc.setFontSize(11);
                doc.setFont("helvetica", "bold");
                doc.text(`Finanzierungsangebot: ${art}`, 20, 85);
                
                // NEU: Artikelnummer und -bezeichnung in Fettdruck hinzufügen
                doc.text(`${artikelnummer} - ${artikelbezeichnung}`, 20, 92);

                doc.setFontSize(10);
                doc.setFont("helvetica", "normal");
                // Y-Werte um jeweils 7mm nach unten geschoben für den neuen Text
                doc.text(salutation, 20, 107);
                doc.text("vielen Dank für das entgegengebrachte Vertrauen! Wie folgt bieten wir Ihnen unverbindlich an:", 20, 117);

                let y = 132; // Auch die Tabelle rückt weiter nach unten
                const rowH = 7;
                const drawRow = (label, val, unit) => {
                    doc.setFont("helvetica", "normal");
                    doc.text(label, 40, y);
                    doc.setFont("helvetica", "bold");
                    doc.text(val, 110, y, { align: "right" });
                    doc.setFont("helvetica", "normal");
                    if (unit) doc.text(unit, 112, y);
                    y += rowH;
                };

                drawRow("Anschaffungspreis:", preisVal, "€");
                drawRow("Laufzeit:", laufzeitVal, "Monate");
                drawRow("Mietsonderzahlung:", "0,00", "€");
                drawRow("Monatliche Rate:", rateVal, "€");
                const hasPercent = leasingfaktorVal.includes('%');
                drawRow("Rate in %:", hasPercent ? leasingfaktorVal.replace('%','').trim() : leasingfaktorVal, "%");
                drawRow("kalk. Restwert:", restwertEuroVal, "€");

                y += 10;
                if (art === "Mietkauf") {
                    doc.setFont("helvetica", "bold");
                    doc.text("Hinweis: Die gesetzl. Mehrwertsteuer fällt vorab auf die Summe aller Zahlungen an.", 20, y);
                    y += 10;
                }

                doc.setFont("helvetica", "normal");
                doc.text("Die oben genannten Preise verstehen sich netto, zuzüglich der gesetzlichen Mehrwertsteuer.", 20, y);
                y += 10; // Abstand angepasst für den neuen Satz

                // NEUER SATZ:
                doc.text(["Auf Wunsch fragen wir dieses Finanzierungsangebot gerne verbindlich für Sie über unseren", "Finanzierungspartner an."], 20, y);
                y += 15;

                doc.text(["Wir freuen uns, für Sie tätig werden zu können und sichern Ihnen bereits jetzt eine faire, schnelle", 
                          "und unbürokratische Abwicklung zu."], 20, y);
                
                y += 20;
                doc.text("Mit freundlichen Grüßen,", 20, y);
                y += 10;
                doc.setFont("helvetica", "bold");
                doc.text("GYS GmbH", 20, y);

                // Fußzeile GYS spezifisch
                doc.setDrawColor(150, 150, 150);
                doc.setLineWidth(0.2);
                doc.line(20, 270, 190, 270);

                doc.setFontSize(5.5);
                doc.setFont("helvetica", "normal");

                // Aktualisierte Footer-Daten für GYS Deutschland GmbH
                doc.text(["GYS GmbH", "Professor-Wieler-Straße 11", "52070 Aachen"], 20, 274);
                doc.text(["Geschäftsführer Bruno Bouygues", "Amtsgericht Aachen HRB 13244", "Ust-IdNr. DE 245366405"], 46, 274);
                doc.text(["Fon (+49) 241 / 189-23-710", "aachen@gys.fr", "www.gys-schweissen.com"], 86, 274);
                
                // Platzhalter Bankdaten (können bei Bedarf im Code angepasst werden)
                doc.text(["Sydbank", "Commerzbank"], 118, 274);
                doc.text(["IBAN DE55 2151 0800 1000 6859 59", "IBAN DE33 2004 0000 0630 1527 00"], 136, 274);
                doc.text(["SYBKDE22", "COBADEFFXXX"], 190, 274, { align: "right" });

                const firmaClean = firma.replace(/[^a-zA-Z0-9]/g, '_');
                const filename = `GYS_${art}_${firmaClean}.pdf`;
                
                // 1. PDF DOWNLOAD STARTEN
                doc.save(filename);

                // 2. EMAILJS PARAMETER VORBEREITEN
                const templateParams = {
                    firma_name: firma,
                    kontakt_name: `${anrede} ${vorname} ${nachname}`,
                    telefon: telefon,
                    email: email,
                    artikelnummer: artikelnummer,
                    artikelbezeichnung: artikelbezeichnung,
                    adresse: strasse,
                    plz_ort: `${plz} ${ort}`,
                    finanzierungsart: art,
                    anschaffungspreis: preisVal,
                    laufzeit: laufzeitVal,
                    rate: rateVal,
                    leasingfaktor: leasingfaktorVal,
                    restwert: restwertEuroVal
                };

                // 3. E-MAIL ABSENDEN
                try {
                    await emailjs.send("service_lg831md", "template_zcqdl76", templateParams);
                    console.log("E-Mail Alert erfolgreich versendet.");
                } catch (emailError) {
                    console.error("Fehler beim E-Mail Versand:", emailError);
                }

            } catch (error) {
                console.error("Fehler bei der PDF Generierung:", error);
                alert("Es ist ein Fehler bei der PDF-Generierung aufgetreten. Überprüfen Sie die Konsole.");
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
